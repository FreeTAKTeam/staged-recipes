= Mumble VoIP Package Roadmap
:toc:
:toclevels: 2

== Current Status

The mumble-voip conda-forge package is under development with the following components:

* ✅ Windows build with MSVC flag fixes
* ❌ **macOS build compatibility issue (BLOCKED)**
* ⚠️  Linux build (untested)
* ✅ Both client (`mumble`) and server (`murmur`) packages

== Known Issues

=== macOS Patch Compatibility Problem

==== Problem Description

The `0002-fix-macos-avfoundation-compatibility.patch` is failing to apply during the build process with the following error:

```
error applying hunk #1: Hunk {
    old_range: HunkRange {
        start: 50,
        len: 6,
    ),
    Context("#endif\n"),
    Context("\n"),
    Insert("#ifdef Q_OS_MAC\n"),
    Insert("#include <AvailabilityMacros.h>\n"),
    // ... more insertions
```

==== Root Cause Analysis

Investigation reveals a **fundamental mismatch** between the patch expectations and the actual source code:

1. **Patch Context Mismatch**: The patch expects to find specific code patterns around line 50 of `src/mumble/AudioInput.cpp`, including:
   - `#include "WebRTC.h"` directive
   - `class AudioInputBuffer` definition
   - Specific `#endif` context

2. **Missing Target Code**: Analysis of Mumble v1.5.735 source shows:
   - No `AudioInputBuffer` class exists in the codebase
   - No `WebRTC.h` includes in AudioInput.cpp
   - No `AVAuthorizationStatus` usage anywhere in the source

3. **Patch Version Mismatch**: The patch appears to be created for a **different version** of Mumble than v1.5.735, or for a different codebase structure entirely.

==== Current Workaround

The macOS patch has been **temporarily disabled** in the recipe configuration:

```yaml
# - if: osx
#   then: patches/0002-fix-macos-avfoundation-compatibility.patch
```

This allows Windows and Linux builds to proceed while the macOS issue is resolved.

== Action Items

=== Immediate (High Priority)

1. **Reproduce the actual build error**
   - Run a macOS build without the patch
   - Capture the exact compilation errors
   - Determine if AVFoundation compatibility is actually needed

2. **Source code verification**
   - Verify that v1.5.735 is the correct Mumble version
   - Check if macOS permission handling exists in this version
   - Compare with other Mumble versions to understand code evolution

3. **Patch reconstruction**
   - If macOS compatibility issues exist, create new patches based on actual v1.5.735 source
   - Target the correct files and line numbers
   - Test patch application in isolation

=== Medium Priority

1. **Test Linux builds**
   - Verify that Linux builds work without the macOS patch
   - Ensure all dependencies are correctly specified
   - Test both client and server packages

2. **Alternative approaches**
   - Research if conda-forge has existing Mumble packages
   - Check upstream Mumble for conda/macOS build instructions
   - Consider runtime feature detection instead of compile-time patches

=== Long Term

1. **Upstream contribution**
   - If patches are needed, consider contributing fixes upstream to Mumble project
   - This would eliminate the need for conda-forge specific patches

2. **Automated testing**
   - Set up CI/CD to catch patch application failures early
   - Test builds across all platforms automatically

== Technical Notes

=== Mumble Version Information

* **Current Target**: v1.5.735
* **Release Date**: Recent (2023-2024)
* **Architecture**: Qt-based C++ application
* **macOS Support**: Native macOS application with potential AVFoundation usage

=== macOS SDK Compatibility

The original patch was designed to handle:

* **Target**: macOS 10.13 compatibility (conda-forge requirement)
* **Issue**: AVFoundation APIs introduced in macOS 10.14
* **Solution**: Conditional compilation with fallback implementations

However, this may not be necessary if v1.5.735 doesn't use these APIs.

=== Dependencies

Key dependencies that may affect macOS builds:

* Qt framework (UI and system integration)
* AVFoundation (if microphone permissions are implemented)
* Opus codec
* Protocol Buffers
* Boost libraries

== Contact and Resources

* **Maintainer**: @phreed
* **Upstream**: https://github.com/mumble-voip/mumble
* **Build Instructions**: https://github.com/mumble-voip/mumble/blob/master/docs/dev/build-instructions/README.md
* **Issue Tracking**: This roadmap document

---
_Last Updated_: December 2024 +
_Status_: Investigation Phase
